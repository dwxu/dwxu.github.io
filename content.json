{"meta":{"title":"Dongwu Xu","subtitle":null,"description":null,"author":"dwxu","url":"http://www.dwxu.me"},"pages":[{"title":"关于我","date":"2018-05-14T14:17:56.926Z","updated":"2018-05-14T14:17:56.924Z","comments":false,"path":"about/index.html","permalink":"http://www.dwxu.me/about/index.html","excerpt":"","text":"1234567891011121314151617181920212223242526272829303132&#123; \"name\": \"Dongwu Xu\", \"age\": 24, \"gender\": \"男\", \"address\": \"广东省广州市\", \"education\": \"本科\", \"profession\": \"计算机\", \"experience\": \"4年\", \"github\": \"https://github.com/dwxu\", \"blog\": \"http://www.dwxu.me\", \"email\": \"121110874@qq.com\", \"skill\":[ [\"Java\"], [\"Spring\", \"Mybatis\", \"Apache Storm\"], [\"Html\", \"Javascript\", \"JQuery\", \"CSS\"], [\"Redis\", \"Kafka\"], [\"MySQL\", \"MariaDB\"], [\"Git\", \"SVN\"], [\"Maven\", \"Ant\"] ], \"os\": [\"masOS\", \"IOS\", \"Windows\", \"Linux\"], \"devTool\":[ [\"IntelliJ IDEA\", \"Eclipse\"], [\"Chrome DevTools\", \"Fiddler\"], [\"Git Bash\", \"TortoiseSVN\"], [\"Navicat\"], [\"Xshell\", \"Xftp\", \"SecureCRT\"] ]&#125;"},{"title":"分类","date":"2018-05-13T15:17:53.082Z","updated":"2018-05-13T15:17:53.082Z","comments":false,"path":"categories/index.html","permalink":"http://www.dwxu.me/categories/index.html","excerpt":"","text":""},{"title":"友情链接","date":"2018-05-13T15:17:53.082Z","updated":"2018-05-13T15:17:53.082Z","comments":true,"path":"links/index.html","permalink":"http://www.dwxu.me/links/index.html","excerpt":"","text":""},{"title":"标签","date":"2018-05-13T15:17:53.083Z","updated":"2018-05-13T15:17:53.083Z","comments":false,"path":"tags/index.html","permalink":"http://www.dwxu.me/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"高并发下多站点在线访问实时统计","slug":"online-statistics","date":"2018-05-16T15:20:09.000Z","updated":"2018-05-16T15:24:15.382Z","comments":true,"path":"2018/05/16/online-statistics/","link":"","permalink":"http://www.dwxu.me/2018/05/16/online-statistics/","excerpt":"","text":"一、业务背景 实时统计多个站点的在线独立访问情况； 统计的时间范围为 10/15/30 分钟； 所有站点每秒累计约 10w 的 pv； 二、解决思路 按客户端 IP+SessionId 区分独立访问； 将在线访问信息（站点ID、IP、Session Id、访问时间等）写入 Kafka 集群； Storm(集群) 实时消费 Kafka 在线访问信息/消息，合并访问写入 Redis； 上层应用从 Redis 获取各站点 10/15/30 分钟内的独立访问数据进行计算并展示； 三、详细设计1. redis 数据结构设计 将每分钟的站点数据写入一个 Hash 集合（过期时间为 30 分钟），key 为 online:{comId}:{minute}，其中 {comId} 为站点ID，{minute} 为在线时间的分钟字段（0-59）； 集合下的元素结构为：field - {ip}:{sessionId}（独立访问），value - 该独立访问一分钟内的请求/响应次数，通过 hincrby 指令递增； 2. 数据统计 统计范围为当前 10/15/30 分钟内； 通过站点ID及当前时间从 redis 中读取该站点 30 分钟内的数据集合，例如站点ID为1，查询时间为 9点33分钟，则从 redis 读取 online:1:33 - online:1:3 的数据集合； 合并数据集合的 key（{ip}:{sessionId}），即去重，即可得到指定时间范围内的在线访问数； 3. 说明 数据写入 Redis 频繁，需要优先考虑写入耗时和内存的问题，因此通过 hincrby 和 expired 这两个时间复杂度为 O(1) 的指令来快速写入在线数据； 每个站点的数据集合过期时间为 30 分钟（根据请求时间计算过期的时间戳），因此一个站点最多同时存在 30 个数据集合，过期的集合由 Redis 自动清理，无需再自行清理； 每个集合的有效数据实际为 field 的部分，记录每分钟的独立访问，接口在获取数据进行统计时，直接取出 field 的 Set 集合进行自动合并即可； 四、线上情况 Redis 单机/单实例； 30分钟内活跃的站点约 1.5w 个，两个小时内监控 Redis，redis 总内存占用稳定在 5.5G 以下（较上线此统计前多占用 1G 内存），数据集合能够正常过期并被 redis 清理； 应用 0.3s 内完成统计访问最频繁/数据量最大的站点的各时段内在线访问情况，当然跟服务器性能比较好也有关系；","categories":[{"name":"解决方案","slug":"解决方案","permalink":"http://www.dwxu.me/categories/解决方案/"}],"tags":[{"name":"实时统计","slug":"实时统计","permalink":"http://www.dwxu.me/tags/实时统计/"},{"name":"Redis","slug":"Redis","permalink":"http://www.dwxu.me/tags/Redis/"}]},{"title":"各大搜索引擎来路referer头部及搜索关键字字段","slug":"search-engine-referer","date":"2018-05-15T12:25:00.000Z","updated":"2018-05-15T12:38:28.993Z","comments":true,"path":"2018/05/15/search-engine-referer/","link":"","permalink":"http://www.dwxu.me/2018/05/15/search-engine-referer/","excerpt":"","text":"1. 百度搜索： PC端： referer： 1https://www.baidu.com/link?url=gZRk-i0rKd2zEpXr6gLWgcMaB6gj49Qh0SRhVyeD1TG&amp;wd=&amp;eqid=e0224cf50000f590000000065ac98dee 关键字字段：wd（无实际值） 移动端： referer： 1https://m.baidu.com/from=0/bd_page_type=1/ssid=0/uid=0/pu=usm%401%2Csz%40320_1001%2Cta%40iphone_2_6.0_3_537/baiduid=EDC0F469B2C8C28ED6153A8DFE7B0F35/w=0_10_/t=iphone/l=1/tc?ref=www_iphone&amp;lid=9293408228010889187&amp;order=1&amp;fm=alop&amp;dict=-1&amp;tj=www_sitelink_normal_1_0_10_title&amp;wd=&amp;eqid=80f8d18b77481000100000005ac98e54&amp;w_qd=IlPT2AEptyoA_yjkTUugn4fHR5kW&amp;tcplug=1&amp;sec=28899&amp;di=6b8e30a65323dcbb&amp;bdenc=1&amp;tch=124.0.206.178.0.0&amp;nsrc=IlPT2AEptyoA_yixCFOxXnANedT62v3IEQGG_8kJLDKv7JuV&amp;clk_info=%7B%22srcid%22%3A1539%2C%22tplname%22%3A%22www_sitelink_normal%22%2C%22t%22%3A1523158616510%2C%22xpath%22%3A%22div-a-h3-em%22%7D 关键字字段：wd（无实际值） 2. 搜狗搜索（soso 搜索）： PC端： referer： 1https://www.sogou.com/link?url=DSOYnZeCC_oowgX7OeX6FW4YafSeot-j 关键字字段：无 移动端： referer： 1https://m.sogou.com/web/searchList.jsp?uID=vU0WMAQthy-ORLar&amp;v=5&amp;from=index&amp;w=1274&amp;t=1523158841365&amp;s_t=1523158844479&amp;s_from=index&amp;keyword=51la%E7%BB%9F%E8%AE%A1&amp;pg=webSearchList&amp;sourceid=sugg&amp;sugoq=&amp;sugn=0&amp;suguuid=fa153a85-07bb-4afa-bb07-69d3775d9966&amp;sugsuv=AAHV9fA6HwAAAAqRK1G8bQ0A1wA%3D&amp;sugtime=1523158844484 1https://wap.sogou.com/web/searchList.jsp?uID=vU0WMAQthy-ORLar&amp;v=5&amp;from=index&amp;w=1274&amp;t=1523158841365&amp;s_t=1523158844479&amp;s_from=index&amp;keyword=51la%E7%BB%9F%E8%AE%A1&amp;pg=webSearchList&amp;sourceid=sugg&amp;sugoq=&amp;sugn=0&amp;suguuid=fa153a85-07bb-4afa-bb07-69d3775d9966&amp;sugsuv=AAHV9fA6HwAAAAqRK1G8bQ0A1wA%3D&amp;sugtime=1523158844484 关键字字段：keyword（有实际值） 3. 360 搜索（360好搜）： PC端： referer： 1http://www.so.com/link?m=afEPOwxb%2BqdAts7rzNmmh%2F2cxMIM5669zqvLn1I5nPYjRlp8haa0nn%2FWJfYFNGvfzb4XdzUBb5wCnL2um08mnoi%2Bsge9ZjqTN referer 关键字字段：无 移动端： referer： 1https://m.so.com/s?q=51la%E7%BB%9F%E8%AE%A1&amp;src=msearch_next_input&amp;sug_pos=&amp;sug=&amp;srcg=home_next 关键字字段：q（有实际值） 4. 谷歌搜索： PC端： referer： 1https://www.google.co.jp/（每个国家/地区的域名后缀不同，如 co.jp - 日本，hk - 香港，de - 德国） referer 关键字字段：无 移动端： referer： 1https://www.google.com/ 关键字字段：无 5. 神马搜索： PC端：无 移动端： referer： 1https://zm12.sm-tc.cn/?src=l4uLj8XQ0IiIiNHKztGTntA%3D&amp;uid=b64442e88b6decc4f6ade0bf131e6af0&amp;hid=0828a13d4a51cd539610a6c5a2e50f36&amp;pos=1&amp;cid=9&amp;time=1523160482592&amp;from=click&amp;restype=1&amp;pagetype=0400000000000004&amp;bu=web&amp;query=51la%E7%BB%9F%E8%AE%A1&amp;mode=&amp;v=1&amp;province=%E5%B9%BF%E4%B8%9C%E7%9C%81&amp;city=%E5%B9%BF%E5%B7%9E%E5%B8%82&amp;uc_param_str=dnntnwvepffrgibijbprsvdsdichei 关键字字段：query（有实际值），host 为 zm12.sm-tc.cn 6. BingLive（微软Bing搜索）： PC端： referer： 1https://www.bing.com/ 关键字字段：无 移动端： referer： 1https://www.bing.com/ 关键字字段：无 7. 有道/网易搜索：目前仅为词典搜索","categories":[{"name":"互联网","slug":"互联网","permalink":"http://www.dwxu.me/categories/互联网/"}],"tags":[{"name":"搜索引擎","slug":"搜索引擎","permalink":"http://www.dwxu.me/tags/搜索引擎/"}]},{"title":"Hello World","slug":"Hello-World","date":"2018-05-14T13:31:51.000Z","updated":"2018-05-14T15:32:08.106Z","comments":true,"path":"2018/05/14/Hello-World/","link":"","permalink":"http://www.dwxu.me/2018/05/14/Hello-World/","excerpt":"","text":"你好，世界！ 不客观的说，自己也不算懒，但也不知道拖延了多久，总算是把个人博客的样子给整出来了。 基于 GitHub + Hexo 搭建，找了一套相对简洁的页面模板，稍微加以改造，便是现在这个样子，还算满意。 年后转到公司新的部门后，一直比较忙，期间也解决了一些大大小小的问题，在业务和技术方面也算有所收获，也一直想着找机会和时间总结并记录下来，于是乎又想起来久违的个人博客计划，花了两个晚上失落，过程比较顺利。 那么，之后要花更多的时间和精力，充实博客，充实自己！ 晚安！","categories":[{"name":"日记","slug":"日记","permalink":"http://www.dwxu.me/categories/日记/"}],"tags":[{"name":"日记","slug":"日记","permalink":"http://www.dwxu.me/tags/日记/"}]}]}